#!/usr/local/bin/perl -w

#use lib '/nfs/disk84/jgrg/bin/Perl';

### spandit

use strict;
use MenuCanvasWindow::XaceSeqChooser;
use MenuCanvasWindow::ExonCanvas;
use Ace;
use Getopt::Long 'GetOptions';

{
    my ($cript) = $0 =~ m{([^/]+)$};
    my $font_size = 0;
    my($host, $port, $path, $title);
    GetOptions(
        'host=s'        => \$host,
        'port=i'        => \$port,
        'path=s'        => \$path,
        'title=s'       => \$title,
        'fontsize=i'    => \$font_size,
        'help!'         => \&useage,
        ) or useage();
    
    if ($path) {
        $title ||= "$cript: $path";
    } else {
        useage() unless $host and $port;
        $title ||= "$cript: $host $port";
    }
    
    my $mw = CanvasWindow::MainWindow->new($title);
    my $xc = MenuCanvasWindow::XaceSeqChooser->new($mw);
    $xc->font_size($font_size) if $font_size;
    $xc->clone_list(@ARGV);
     
    my( $local_server, $ace );
    if ($path) {
        $local_server = Hum::Ace::LocalServer->new($path);
        $local_server->server_type('SOCKET');
        $local_server->start_server;
        $xc->local_server($local_server);
    } else {
        $ace = Ace->connect(
            -HOST       => $host,
            -PORT       => $port,
            -TIMEOUT    => 60,
            ) or die "Can't connect to db on '$host' port '$port' :\n", Ace->error;
        $ace->auto_save(0);
        $xc->ace_handle($ace);
    }
    
    $xc->draw_clone_list;
    $xc->fix_window_min_max_sizes;
    
    my %methods_mutable = (
      # Method name        Mutable?
        #supported       => 1,
        supported_CDS   => 1,
        supported_mRNA  => 1,
        Pseudogene      => 1,
        fgenesh         => 0,
        FGENES          => 0,
        GENSCAN         => 0,
        HALFWISE        => 0,
        SPAN            => 0,
        );
    $xc->set_known_GeneMethods(%methods_mutable);
    
    Tk::MainLoop();
}


sub useage {
    exec('perldoc', $0);
}

__END__

=head1 NAME - spandit

=head1 FEATURE

    Sequence
        Exon coordinates
        CDS Start/End
        Start_not_found     CDS_Phase
                            Continues_From
        End_not_found       Continues_As
        Method  Supported
                Supported_CDS
                Supported_mRNA
                Pseudogene
        Remark
        Isoform
    
    Locus
        Name
        Alias
        Type    Pseudogene
                Putative
                Gene    Known
                        Novel_CDS   Human_supported
                                    Non_human_supported
                        Novel_Transcript

=head1 SYNOPSIS

    spandit <-path <ACE DATABASE DIR> | -host <SERVER> -port <NUMBER>>

=head1 AUTHOR

James Gilbert B<email> jgrg@sanger.ac.uk

